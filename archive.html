<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Retail Trends ‚Äî Archive</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:20px}
.container{max-width:1100px;margin:0 auto}
header{text-align:center;color:#fff;margin-bottom:18px}
h1{font-size:2em;margin-bottom:6px;text-shadow:2px 2px 4px rgba(0,0,0,.2)}
.controls{background:#fff;padding:12px 16px;border-radius:12px;box-shadow:0 8px 16px rgba(0,0,0,.08);display:flex;gap:10px;align-items:center;justify-content:space-between;margin-bottom:16px}
input[type="search"]{width:320px;max-width:60vw;border:2px solid #e0e0e0;border-radius:8px;padding:8px 10px;font-size:14px}
.section{background:#fff;border-radius:12px;box-shadow:0 8px 16px rgba(0,0,0,.08);padding:18px;margin-bottom:14px}
.section h2{border-bottom:3px solid #667eea;padding-bottom:6px;margin-bottom:12px}
details{background:#f9f9f9;border-radius:10px;padding:10px;margin-bottom:8px}
summary{cursor:pointer;font-weight:800}
ul{margin:8px 0 0 18px}
li{margin:6px 0}
a{color:#667eea;text-decoration:none;font-weight:700}
a:hover{text-decoration:underline}
.muted{color:#eee}
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>üì¶ Archive</h1>
    <div class="muted">Grouped by day ‚Ä¢ instant search</div>
    <div style="margin-top:8px"><a href="index.html" style="background:#fff;color:#667eea;padding:8px 12px;border-radius:10px;font-weight:800;text-decoration:none">‚Üê Back to Home</a></div>
  </header>

  <div class="controls">
    <div>
      <input id="q" type="search" placeholder="Search title, source, keywords, brands‚Ä¶"/>
      <button id="clear">Clear</button>
    </div>
    <div id="status">Ready</div>
  </div>

  <div class="section">
    <h2>All Articles</h2>
    <div id="archive"></div>
  </div>
</div>

<script>
const DATA_URL = "./data/articles.json";

function groupByDate(items){
  const map={};
  for(const a of items){
    const d=new Date(a.published||Date.now()).toISOString().slice(0,10);
    (map[d]=map[d]||[]).push(a);
  }
  return Object.entries(map).sort((a,b)=> b[0].localeCompare(a[0]));
}
function row(a){
  const tags=[...(a.keywords||[]),...(a.brands||[])].map(t=>`<span style="background:#e0e7ff;color:#667eea;border-radius:12px;padding:2px 8px;font-size:11px;font-weight:700;margin-left:6px">${t}</span>`).join("");
  return `<li><a href="${a.link}" target="_blank" rel="noopener">${a.title}</a> <small style="color:#667eea"> ¬∑ ${a.source||'Source'}</small>${tags}</li>`;
}
function render(items){
  const groups=groupByDate(items);
  const html=groups.map(([day,list])=>`<details><summary>${day} ‚Äî ${list.length} articles</summary><ul>${list.map(row).join("")}</ul></details>`).join("");
  document.getElementById('archive').innerHTML=html||'<div class="muted">No items.</div>';
}
async function loadData(){
  document.getElementById('status').textContent='Loading‚Ä¶';
  const res=await fetch(DATA_URL+'?t='+Date.now()); const data=await res.json();
  const items=(data.items||[]).filter(a=>a.published).sort((a,b)=>b.published-a.published);
  window.__ALL = items;
  render(items);
  document.getElementById('status').textContent='Updated '+new Date(data.generatedAt).toLocaleString();
}
function matches(a, q){
  if(!q) return true; const s=q.toLowerCase();
  return (a.title||'').toLowerCase().includes(s) ||
         (a.source||'').toLowerCase().includes(s) ||
         (a.excerpt||'').toLowerCase().includes(s) ||
         (a.keywords||[]).join(' ').toLowerCase().includes(s) ||
         (a.brands||[]).join(' ').toLowerCase().includes(s);
}
document.getElementById('q').addEventListener('input', e=>{
  const q=e.target.value.trim(); const items=(window.__ALL||[]).filter(a=>matches(a,q));
  render(items);
});
document.getElementById('clear').addEventListener('click', ()=>{
  const q=document.getElementById('q'); q.value=''; render(window.__ALL||[]);
});
loadData().catch(e=> document.getElementById('status').textContent='Error: '+e.message);
</script>
</body>
</html>
